@if (weeks().length > 0) {
  <!-- Desktop: tab bar -->
  <nav class="matchups__tabs" mat-tab-nav-bar [tabPanel]="tabPanel">
    @for (week of weeks(); track week.key) {
      <a
        mat-tab-link
        [routerLink]="['..', week.key]"
        routerLinkActive
        #rla="routerLinkActive"
        [active]="rla.isActive"
      >{{ week.number }}</a>
    }
  </nav>
  <mat-tab-nav-panel #tabPanel />

  <!-- Mobile: prev / Week N / next -->
  <nav class="matchups__mobile-nav" aria-label="Week navigation">
    <a
      mat-icon-button
      [routerLink]="prevWeekKey() ? ['..', prevWeekKey()] : null"
      [disabled]="!prevWeekKey()"
      aria-label="Previous week"
    ><mat-icon>chevron_left</mat-icon></a>

    <span class="matchups__mobile-label">{{ activeWeekLabel() }}</span>

    <a
      mat-icon-button
      [routerLink]="nextWeekKey() ? ['..', nextWeekKey()] : null"
      [disabled]="!nextWeekKey()"
      aria-label="Next week"
    ><mat-icon>chevron_right</mat-icon></a>
  </nav>

  @if (weekStats(); as stats) {
    <div class="matchups__stats">
      @if (stats.highScore; as high) {
        <app-stat-card
          class="matchups__stat--compact"
          title="High Score"
          [footer]="high.teamName + ' - ' + high.ownerName"
        >
          <app-stat-value [context]="high.teamName" [value]="high.score.toFixed(2)" [subscript]="high.ownerName" />
        </app-stat-card>
      }

      @if (stats.lowScore; as low) {
        <app-stat-card
          class="matchups__stat--compact"
          title="Low Score"
          [footer]="low.teamName + ' - ' + low.ownerName"
        >
          <app-stat-value [value]="low.score.toFixed(2)" />
        </app-stat-card>
      }

      @if (stats.biggestLoser; as bl) {
        <app-stat-card
          class="matchups__stat--compact"
          title="Biggest Loser"
          [footer]="bl.teamName + ' - ' + bl.ownerName"
        >
          <app-stat-value [value]="'-' + bl.margin!.toFixed(2)" />
        </app-stat-card>
      }

      @if (stats.narrowestWin; as nw) {
        <app-stat-card
          class="matchups__stat--compact"
          title="Narrowest Win"
          [footer]="nw.teamName + ' - ' + nw.ownerName"
        >
          <app-stat-value [value]="nw.margin!.toFixed(2)" />
        </app-stat-card>
      }

      @if (stats.exceededExpectation; as ee) {
        <app-stat-card
          class="matchups__stat--compact"
          title="Exceeded Expectation"
          [footer]="ee.teamName + ' - ' + ee.ownerName"
        >
          <app-stat-value [value]="ee.delta!.toFixed(2)" />
        </app-stat-card>
      }

      @if (stats.underperformed; as up) {
        <app-stat-card
          class="matchups__stat--compact"
          title="Underperformed"
          [footer]="up.teamName + ' - ' + up.ownerName"
        >
          <app-stat-value [value]="up.delta!.toFixed(2)" />
        </app-stat-card>
      }

      @if (stats.mvp; as mvp) {
        <app-stat-card
          class="matchups__stat--compact"
          title="MVP"
          [footer]="mvp.teamName + ' - ' + mvp.ownerName"
        >
          <app-stat-value
            [context]="mvp.playerName + ' · ' + (mvp.position === 'R/W/T' ? 'Flex' : mvp.position)"
            [value]="mvp.percentage!.toFixed(1) + '%'"
          />
        </app-stat-card>
      }

      @if (stats.highStarter; as hs) {
        <app-stat-card
          class="matchups__stat--compact"
          title="Top Starter"
          [footer]="hs.teamName + ' - ' + hs.ownerName"
        >
          <app-stat-value
            [context]="hs.playerName + ' · ' + (hs.position === 'R/W/T' ? 'Flex' : hs.position)"
            [value]="hs.points.toFixed(2)"
          />
        </app-stat-card>
      }

      @if (stats.lowStarter; as ls) {
        <app-stat-card
          class="matchups__stat--compact"
          title="Lowest Starter"
          subtitle="Non-zero score only"
          [footer]="ls.teamName + ' - ' + ls.ownerName"
        >
          <app-stat-value
            [context]="ls.playerName + ' · ' + (ls.position === 'R/W/T' ? 'Flex' : ls.position)"
            [value]="ls.points.toFixed(2)"
          />
        </app-stat-card>
      }
    </div>
  }

  <div class="matchups__cards">
    @for (matchup of matchups(); track matchup.team1.teamName) {
      <app-matchup-card [team1]="matchup.team1" [team2]="matchup.team2" />
    } @empty {
      <p>No matchup data available for this week.</p>
    }
  </div>
}

